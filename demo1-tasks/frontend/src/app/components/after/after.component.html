<div class="after-container">
  <div class="query-section">
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="query"
        (keypress)="onKeyPress($event)"
        placeholder="Show me overdue tasks assigned to Sarah..."
        class="query-input"
        [disabled]="loading"
      />
      @if (rawJsonResponse) {
        <button
          class="json-toggle-button"
          (click)="toggleJsonDisplay()"
          title="{{ showJson ? 'Hide JSON Response' : 'Show JSON Response' }}"
        >
          ğŸ“‹
        </button>
      }
      <button
        (click)="executeQuery()"
        [disabled]="!query.trim() || loading"
        class="search-button"
      >
        @if (loading) {
          <span class="button-spinner"></span>
        } @else {
          ğŸ” Search
        }
      </button>

      <div class="ai-toggle-wrapper">
        <span class="ai-toggle-label">AI </span>
        <label class="ai-toggle-switch">
          <input
            type="checkbox"
            [checked]="true"
            (change)="toggleAI()"
          />
          <span class="ai-toggle-slider"></span>
        </label>
      </div>
    </div>

    @if (explanation) {
      <div class="explanation">
        <strong>Understood:</strong> {{ explanation }}
      </div>
    }

    @if (error) {
      <div class="error-message">
        âŒ {{ error }}
      </div>
    }

    @if (showJson && rawJsonResponse) {
      <div class="json-display">
        <div class="json-header">
          <strong>ğŸ” Raw API Response:</strong>
        </div>
        <pre class="json-content">{{ getFormattedJson() }}</pre>
      </div>
    }
  </div>

  <div class="examples-section">
    <p class="examples-label">Try these examples:</p>
    <div class="example-buttons">
      @for (example of exampleQueries; track example) {
        <button
          class="example-button"
          (click)="useExample(example)"
          [disabled]="loading"
        >
          {{ example }}
        </button>
      }
    </div>
  </div>

  @if (needsClarification) {
    <app-clarification
      [message]="clarificationMessage"
      [suggestions]="suggestions"
      (suggestionSelected)="onSuggestionSelected($event)"
    ></app-clarification>
  }

    @if (!hasSearched || tasks.length === 0) {
    <div class="data-model-section">
    <h3>ğŸ“Š Task Data Model</h3>
    <p class="data-model-description">
      Our system can filter by these fields. The LLM is constrained to only use these valid fields:
    </p>
    <div class="schema-grid">
      <div class="schema-field">
        <div class="field-name">assignee</div>
        <div class="field-type">string</div>
        <div class="field-example">e.g., "Sarah Chen"</div>
      </div>
      <div class="schema-field">
        <div class="field-name">status</div>
        <div class="field-type">"todo" | "in-progress" | "done"</div>
        <div class="field-example">e.g., "in-progress"</div>
      </div>
      <div class="schema-field">
        <div class="field-name">priority</div>
        <div class="field-type">"low" | "medium" | "high"</div>
        <div class="field-example">e.g., "high"</div>
      </div>
      <div class="schema-field">
        <div class="field-name">dueDate</div>
        <div class="field-type">{{ '{' }} before?: string, after?: string {{ '}' }}</div>
        <div class="field-example">e.g., before: "2025-10-30"</div>
      </div>
    </div>
    <p class="schema-note">
      âš ï¸ Fields like <code>tags</code>, <code>category</code>, or <code>project</code> don't exist.
      Without proper constraints, the LLM might hallucinate these fields!
    </p>
  </div>
}

  <div class="results-section">
    <app-task-list
      [tasks]="tasks"
      [loading]="loading"
      [hasSearched]="hasSearched"
      [hasError]="!!error"
    ></app-task-list>
  </div>

  @if (false && hasSearched) {
    <div class="benefits">
      <h3>âœ¨ Benefits of Natural Language</h3>
      <ul>
        <li>ğŸ“ <strong>Type naturally</strong> - no need to learn complex UI</li>
        <li>ğŸ¤– <strong>AI-powered</strong> - understands context and intent</li>
        <li>ğŸ’¬ <strong>Asks for clarification</strong> - when ambiguous (try "Show me Sarah's tasks")</li>
        <li>ğŸ›¡ï¸ <strong>Safe</strong> - rejects dangerous queries (try "Delete all tasks")</li>
        <li>âš¡ <strong>10 lines of UI</strong> instead of 100+</li>
      </ul>
    </div>
  }


</div>

